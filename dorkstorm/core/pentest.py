from core.utils import print_url_table
from time import sleep

class PenetrationTest:
    
    def test_website(self, context, domain):
        """
        Execute all queries in the database against the given website domain
        
        Info: 3s timeout
        """
        
        query_count = context.database.get_query_count()
        
        for i in range(1, query_count):
            query = context.database.query_by_id(i)
            
            context.query["configs"]["base_query_params"] = query["query"]
            context.query["configs"]["base_query_id"] = i
            context.query["configs"]["extra_query_params"]["site"] = domain
            
            builded_query = context.dork_engine.build_query(context.query)
            
            result = context.dork_engine.google_search(query=builded_query, limit=1)
            
            print("[PENTEST] EXECUTED %s", query)
            print_url_table(result)
            
            sleep(3)
